## 1. –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- –í—Å–µ —Ñ–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–æ –≤–Ω–µ—à–Ω–µ–º **Yandex Object Storage (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º)**.
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–æ–≤** —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL (`file_metadata`).
- –î–ª—è —Ñ–∞–π–ª–æ–≤ **‚â• 100 –ú–ë** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **multipart upload** —á–µ—Ä–µ–∑ **–±—ç–∫–µ–Ω–¥**.
- **MinIO** ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è Worker‚Äô–∞, –µ–≥–æ API –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è.
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ S3** ‚Äî –≤—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ REST API —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

---

## 2. –ß–∞–Ω–∫–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ –±—ç–∫–µ–Ω–¥

–ö–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞:

1. **`POST /files/upload/init`**  
   ‚Üí –ü–æ–ª—É—á–∞–µ—Ç `uploadId` –∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π `partSize` (–º–∏–Ω–∏–º—É–º 5 –ú–ë).

2. **`PUT /files/upload/{uploadId}/part`**  
   ‚Üí –ó–∞–≥—Ä—É–∂–∞–µ—Ç —á–∞—Å—Ç—å —Ñ–∞–π–ª–∞ –∫–∞–∫ `application/octet-stream`.  
   ‚Üí –ü–µ—Ä–µ–¥–∞—ë—Ç –Ω–æ–º–µ—Ä —á–∞—Å—Ç–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Part-Number`.

3. **`POST /files/upload/{uploadId}/complete`**  
   ‚Üí –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

> –§–∞–π–ª–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å **—Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç multipart-—Å–µ—Å—Å–∏–µ–π –≤ Yandex S3**:
> - –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç `startUpload`,
> - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å —á–µ—Ä–µ–∑ `uploadPart`,
> - –•—Ä–∞–Ω–∏—Ç `(PartNumber, ETag)` **–≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Redis)**,
> - –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–æ–±–∏—Ä–∞–µ—Ç XML –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `completeUpload`.

> **–î–∞–Ω–Ω—ã–µ multipart-—Å–µ—Å—Å–∏–∏ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL** ‚Äî —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞.

---

## 3. –¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –§–∞–π–ª—ã –æ—Ç–∑—ã–≤–æ–≤ (–ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é)
1. –ü–æ—Å–ª–µ `complete` ‚Üí —Ñ–∞–π–ª –ø–æ–ø–∞–¥–∞–µ—Ç –≤ **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤**.
2. –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è:
   - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ (`.jpg`, `.mp4`),
   - MIME-type (–ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ),
   - –†–∞–∑–º–µ—Ä (‚â§ 5 –ì–ë),
   - –§–æ—Ä–º–∞—Ç (–≤–∞–ª–∏–¥–Ω—ã–π JPEG, MP4).
3. –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞, —Å—Ç–∞—Ç—É—Å `PENDING`, –∑–∞—Ç–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Kafka.
4. –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ–π–¥–ª–µ–Ω–∞, —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ S3, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `400 Bad Request`.

### –§–∞–π–ª—ã –æ—Ç—á—ë—Ç–æ–≤ (–±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
- –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–µ–º –∂–µ —Å–ø–æ—Å–æ–±–æ–º (—á–µ—Ä–µ–∑ `/init`, `/part`, `/complete`),
- –ù–æ –ø–æ—Å–ª–µ `complete` —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞—é—Ç —Å—Ç–∞—Ç—É—Å `READY`,
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.

---

## 4. S3-–∫–æ–Ω—Ç—Ä–∞–∫—Ç (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª–æ–≤—ã–º —Å–µ—Ä–≤–∏—Å–æ–º)

| –û–ø–µ—Ä–∞—Ü–∏—è | HTTP-–º–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----------|------|---------|
| –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è | `POST` | `/{bucket}/{key}?uploads` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `UploadId` |
| –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Å—Ç–∏ | `PUT` | `/{bucket}/{key}?partNumber=N&uploadId=id` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `ETag` —á–∞—Å—Ç–∏ |
| –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ | `POST` | `/{bucket}/{key}?uploadId=id` | –¢–µ–ª–æ: XML —Å–æ —Å–ø–∏—Å–∫–æ–º —á–∞—Å—Ç–µ–π |
| –°–∫–∞—á–∏–≤–∞–Ω–∏–µ (Worker) | `GET` | `/{bucket}/{key}` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–π–ª –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ |
| –£–¥–∞–ª–µ–Ω–∏–µ | `DELETE` | `/{bucket}/{key}` | –£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª –∏–∑ S3 |

> üîí –≠—Ç–∏ –≤—ã–∑–æ–≤—ã **–Ω–µ –≤–∏–¥–Ω—ã –∫–ª–∏–µ–Ω—Ç—É** ‚Äî –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ** –Ω–∞—à–∏–º —Å–µ—Ä–≤–∏—Å–æ–º.

---

## 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ Worker‚Äô–æ–º

1. –ü–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞—á—É –∏–∑ Kafka.
2. –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª –∏–∑ Yandex (`GET /{bucket}/{key}`).
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π MinIO.
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞–Ω—Ç–∏–≤–∏—Ä—É—Å (KESL).
5. –ï—Å–ª–∏ —É–≥—Ä–æ–∑ –Ω–µ—Ç ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–¥–∏–∞ (—Å–∂–∞—Ç–∏–µ/–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è).
6. –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –æ–±—Ä–∞—Ç–Ω–æ –≤ Yandex,
   - –£–¥–∞–ª—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª—ã,
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `READY`.

---

## 6. –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

- –ü—Ä–∏ `DELETE /files/{id}`:
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `deleted_at = NOW()` (–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ),
  - –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª –∏–∑ Yandex —á–µ—Ä–µ–∑ `DELETE /{bucket}/{key}`.