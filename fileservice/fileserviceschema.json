{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/a-dobritsa/spareparts_for_everyone/blob/main/fileservice/fileserviceschema.json",
  "title": "Схемы API файлового сервиса Spare Parts for Everyone",
  "description": "Набор JSON Schema (Draft 2020-12) для валидации тел запросов и ответов в API управления файлами.",
  "type": "object",
  "properties": {
    "FileUploadInitRequest": {
      "type": "object",
      "description": "Тело запроса для инициации чанковой загрузки файла. Содержит метаданные и общий размер.",
      "properties": {
        "filename": {
          "type": "string",
          "description": "Имя файла без пути. Не должно содержать символов '/', '\\'.",
          "minLength": 1,
          "maxLength": 255,
          "pattern": "^[^/\\\\]+$",
          "example": "review_video.mp4"
        },
        "contentType": {
          "type": "string",
          "description": "MIME-тип файла (например, video/mp4, image/jpeg).",
          "maxLength": 100,
          "example": "video/mp4"
        },
        "totalSize": {
          "type": "integer",
          "description": "Общий размер файла в байтах. Максимальный допустимый размер — 5 ГБ.",
          "minimum": 1,
          "maximum": 5368709120,
          "example": 2147483648
        }
      },
      "required": ["filename", "contentType", "totalSize"],
      "additionalProperties": false
    },
    "FileUploadInitResponse": {
      "type": "object",
      "description": "Ответ на успешную инициацию чанковой загрузки. Содержит идентификатор сессии и рекомендуемый размер части.",
      "properties": {
        "uploadId": {
          "type": "string",
          "description": "Уникальный идентификатор сессии загрузки.",
          "pattern": "^[a-zA-Z0-9_-]{1,64}$",
          "example": "upload_abc123"
        },
        "partSize": {
          "type": "integer",
          "description": "Рекомендуемый размер каждой части в байтах (минимум 5 МБ).",
          "minimum": 5242880,
          "example": 5242880
        }
      },
      "required": ["uploadId", "partSize"],
      "additionalProperties": false
    },
    "FilePartResponse": {
      "type": "object",
      "description": "Ответ на успешную загрузку одной части файла. Содержит номер части и её ETag.",
      "properties": {
        "partNumber": {
          "type": "integer",
          "description": "Порядковый номер части (начиная с 1).",
          "minimum": 1,
          "example": 1
        },
        "etag": {
          "type": "string",
          "description": "ETag части, возвращённый S3-хранилищем (включая кавычки).",
          "example": "\"abc123def456...\""
        }
      },
      "required": ["partNumber", "etag"],
      "additionalProperties": false
    },
    "FileUploadCompleteRequest": {
      "type": "object",
      "description": "Тело запроса для завершения чанковой загрузки. Содержит информацию о владельце файла.",
      "properties": {
        "ownerId": {
          "type": "string",
          "description": "Идентификатор владельца файла: пользователя, сервиса отзывов или сервиса отчётности.",
          "example": "review_service_123"
        },
        "ownerType": {
          "type": "string",
          "description": "Тип владельца файла.",
          "enum": ["USER", "REVIEW_SERVICE", "REPORT_SERVICE"],
          "example": "REVIEW_SERVICE"
        }
      },
      "required": ["ownerId", "ownerType"],
      "additionalProperties": false
    },

    "FileMetadataRequest": {
      "type": "object",
      "description": "Тело запроса для регистрации нового файла. Содержит метаданные, необходимые для загрузки и последующей обработки.",
      "properties": {
        "ownerId": {
          "type": "string",
          "description": "Идентификатор владельца файла: пользователя, сервиса отзывов или сервиса отчётности.",
          "example": "review_service_123"
        },
        "ownerType": {
          "type": "string",
          "description": "Тип владельца файла.",
          "enum": ["USER", "REVIEW_SERVICE", "REPORT_SERVICE"],
          "example": "REVIEW_SERVICE"
        },
        "filename": {
          "type": "string",
          "description": "Имя файла без пути. Не должно содержать символов '/', '\\'.",
          "minLength": 1,
          "maxLength": 255,
          "pattern": "^[^/\\\\]+$",
          "example": "review_photo.jpg"
        },
        "contentType": {
          "type": "string",
          "description": "MIME-тип файла (например, image/jpeg, video/mp4).",
          "maxLength": 100,
          "example": "image/jpeg"
        },
        "sizeBytes": {
          "type": "integer",
          "description": "Размер файла в байтах. Максимальный допустимый размер — 5 ГБ.",
          "minimum": 0,
          "maximum": 5368709120,
          "example": 2097152
        },
        "storagePath": {
          "type": "string",
          "description": "Путь к файлу во внешнем S3-совместимом хранилище (Yandex Object Storage).",
          "maxLength": 512,
          "example": "reviews/user123/photo.jpg"
        }
      },
      "required": ["ownerId", "ownerType", "filename", "contentType", "sizeBytes", "storagePath"],
      "additionalProperties": false
    },
    "FileMetadataResponse": {
      "type": "object",
      "description": "Полный ответ с метаданными файла, включая статус обработки и гипермедиа-ссылки (HATEOAS).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Уникальный идентификатор файла, генерируемый сервером.",
          "example": "file_abc123"
        },
        "ownerId": { "type": "string", "example": "review_service_123" },
        "ownerType": {
          "type": "string",
          "enum": ["USER", "REVIEW_SERVICE", "REPORT_SERVICE"],
          "example": "REVIEW_SERVICE"
        },
        "filename": { "type": "string", "example": "review_photo.jpg" },
        "contentType": { "type": "string", "example": "image/jpeg" },
        "sizeBytes": { "type": "integer", "example": 2097152 },
        "storagePath": { "type": "string", "example": "reviews/user123/photo.jpg" },
        "status": {
          "type": "string",
          "description": "Текущий статус обработки файла.",
          "enum": ["PENDING", "VALIDATED", "PROCESSING", "READY", "REJECTED", "LOCKED"],
          "example": "READY"
        },
        "createdAt": {
          "type": "string",
          "description": "Дата и время создания записи в формате ISO 8601.",
          "format": "date-time",
          "example": "2025-12-30T10:00:00Z"
        },
        "updatedAt": {
          "type": "string",
          "description": "Дата и время последнего изменения записи.",
          "format": "date-time",
          "example": "2025-12-30T10:05:00Z"
        },
        "_etag": {
          "type": "string",
          "description": "ETag ресурса для поддержки условных запросов (If-Match).",
          "example": "a1b2c3d4e5f6"
        },
        "_links": {
          "type": "array",
          "description": "Список гипермедиа-ссылок (HATEOAS), описывающих допустимые действия с файлом.",
          "items": {
            "type": "object",
            "properties": {
              "method": {
                "type": "string",
                "enum": ["GET", "PATCH", "DELETE"],
                "example": "PATCH"
              },
              "href": {
                "type": "string",
                "format": "uri",
                "example": "/files/file_abc123"
              }
            },
            "required": ["method", "href"],
            "additionalProperties": false
          },
          "minItems": 1,
          "example": [
            { "method": "GET", "href": "/files/file_abc123" },
            { "method": "PATCH", "href": "/files/file_abc123" },
            { "method": "DELETE", "href": "/files/file_abc123" }
          ]
        }
      },
      "required": ["id", "ownerId", "ownerType", "filename", "contentType", "sizeBytes", "storagePath", "status", "createdAt", "updatedAt", "_etag", "_links"],
      "additionalProperties": false
    },
    "UpdateFileStatusRequest": {
      "type": "object",
      "description": "Тело запроса для обновления статуса файла (например, после асинхронной обработки).",
      "properties": {
        "status": {
          "type": "string",
          "description": "Новый статус файла.",
          "enum": ["VALIDATED", "PROCESSING", "READY", "REJECTED"],
          "example": "READY"
        }
      },
      "required": ["status"],
      "additionalProperties": false
    },
    "ValidationError": {
      "type": "object",
      "description": "Общая ошибка валидации входных данных.",
      "properties": {
        "error": { "type": "string", "example": "validation_error" },
        "message": { "type": "string", "example": "Недопустимое значение поля 'filename'" }
      },
      "required": ["error", "message"],
      "additionalProperties": false
    },
    "ConflictError": {
      "type": "object",
      "description": "Ошибка конфликта: файл с таким Idempotency-Key уже существует или ETag устарел.",
      "properties": {
        "error": { "type": "string", "example": "conflict" },
        "message": { "type": "string", "example": "Файл с таким Idempotency-Key уже зарегистрирован" }
      },
      "required": ["error", "message"],
      "additionalProperties": false
    },
    "NotFoundError": {
      "type": "object",
      "description": "Ресурс не найден или недоступен (для защиты конфиденциальности).",
      "properties": {
        "error": { "type": "string", "example": "not_found" },
        "message": { "type": "string", "example": "Файл не найден или недоступен" }
      },
      "required": ["error", "message"],
      "additionalProperties": false
    },
    "LockedError": {
      "type": "object",
      "description": "Файл заблокирован для изменений (например, помечен на удаление).",
      "properties": {
        "error": { "type": "string", "example": "locked" },
        "message": { "type": "string", "example": "Файл заблокирован для изменений" }
      },
      "required": ["error", "message"],
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}