@startuml
title Создание заказа
skinparam activity {
startColor green
endColor red
stopColor red
}

swimlane Клиент
start
    : Переход к оформлению корзины с товарами;
    note 
      POST/checkout
    end note
swimlane Сервер
        if (Токен не валидный/ не актуальный?) then (Да)
swimlane Клиент
        : Не авторизован;
        note
          401 Unauthorized
        end note
        end
        else
        :Ввод адреса;
        endif
swimlane Сервер
          if (Адрес не валиден?) then (Да)
swimlane Клиент
          :Невалидный адресс;
          note
            400 Bad Request
            error "invalid address"
          end note
          end
          else
swimlane Сервер
            if (Есть отсутствующие товары из корзины?) then (Да)
swimlane Клиент
            :Нет в наличии;
            note 
             400 Bad Request
              error"out of stock"
            end note
            end
            else
swimlane Сервер
              :Сохранить позиции заказа;
              note
                INSERT INTO order_items (...);
              end note
          endif
            endif
swimlane Клиент
                :Успешно;
                note
                  201 Created
                endnote
            stop
@enduml